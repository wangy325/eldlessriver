<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>在SpringBoot中使用MessageSource - Endless River</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="wangy325" /><meta name="description" content=" 几个说明：
 properties配置文件中，spring.messages.basename必须要加classpath前缀。如 spring.messages.basename=classpath:i18n/messages； 必须要手动配置MessageSource，springboot不会自动配置之； 如果使用MessageSource.getMessage()方法，第一个参数的引用形式为&amp;quot;code&amp;quot;，而不是&amp;quot;{code}&amp;quot;或者&amp;quot;${code}&amp;quot;。如messageSource.getMessage(&amp;ldquo;test.msg&amp;rdquo;, null, Locale.getDefault())； 在配置LocalValidatorFactoryBean之后，才可以在javax.validation.constraints包下的注解（@Size，@NotNull&amp;hellip;）下的message属性中使用&amp;quot;{code}&amp;quot;的形式声明校验提示信息。如 @NotNull(message = &amp;quot;{leftTime.not.null}&amp;quot;)； springMVC的locale配置和JVM的locale配置不一样，在application.properties中配置的spring.mvc.locale=zh_CN实际上配置的是WebMvcProperties，在获取消息时，locale信息应该使用webMvcProperties.getLocale()1获取而不是使用Locale.getDefault()获取。   1 概览 MessageSource is a powerful feature available in Spring applications. This helps application developers handle various complex scenarios with writing much extra code, such as environment-specific configuration, internationalization or configurable values.
One more scenario could be modifying the default validation messages to more user-friendly/custom messages.
In this tutorial, we&amp;rsquo;ll see how to configure and manage custom validation MessageSource in the application using Spring Boot.
" />






<meta name="generator" content="Hugo 0.55.6 with even 4.0.0" />


<link rel="canonical" href="https://wangy325.top/post/tech/java/use-springboot-messagesource/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.886d4da2.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="在SpringBoot中使用MessageSource" />
<meta property="og:description" content="
几个说明：


properties配置文件中，spring.messages.basename必须要加classpath前缀。如 spring.messages.basename=classpath:i18n/messages；
必须要手动配置MessageSource，springboot不会自动配置之；
如果使用MessageSource.getMessage()方法，第一个参数的引用形式为&quot;code&quot;，而不是&quot;{code}&quot;或者&quot;${code}&quot;。如messageSource.getMessage(&ldquo;test.msg&rdquo;, null, Locale.getDefault())；
在配置LocalValidatorFactoryBean之后，才可以在javax.validation.constraints包下的注解（@Size，@NotNull&hellip;）下的message属性中使用&quot;{code}&quot;的形式声明校验提示信息。如
@NotNull(message = &quot;{leftTime.not.null}&quot;)；
springMVC的locale配置和JVM的locale配置不一样，在application.properties中配置的spring.mvc.locale=zh_CN实际上配置的是WebMvcProperties，在获取消息时，locale信息应该使用webMvcProperties.getLocale()1获取而不是使用Locale.getDefault()获取。





1 概览

MessageSource is a powerful feature available in Spring applications. This helps application developers handle various complex scenarios with writing much extra code, such as environment-specific configuration, internationalization or configurable values.

One more scenario could be modifying the default validation messages to more user-friendly/custom messages.

In this tutorial, we&rsquo;ll see how to configure and manage custom validation MessageSource in the application using Spring Boot." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wangy325.top/post/tech/java/use-springboot-messagesource/" />
<meta property="article:published_time" content="2021-02-20T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2021-03-03T23:58:24&#43;08:00"/>

<meta itemprop="name" content="在SpringBoot中使用MessageSource">
<meta itemprop="description" content="
几个说明：


properties配置文件中，spring.messages.basename必须要加classpath前缀。如 spring.messages.basename=classpath:i18n/messages；
必须要手动配置MessageSource，springboot不会自动配置之；
如果使用MessageSource.getMessage()方法，第一个参数的引用形式为&quot;code&quot;，而不是&quot;{code}&quot;或者&quot;${code}&quot;。如messageSource.getMessage(&ldquo;test.msg&rdquo;, null, Locale.getDefault())；
在配置LocalValidatorFactoryBean之后，才可以在javax.validation.constraints包下的注解（@Size，@NotNull&hellip;）下的message属性中使用&quot;{code}&quot;的形式声明校验提示信息。如
@NotNull(message = &quot;{leftTime.not.null}&quot;)；
springMVC的locale配置和JVM的locale配置不一样，在application.properties中配置的spring.mvc.locale=zh_CN实际上配置的是WebMvcProperties，在获取消息时，locale信息应该使用webMvcProperties.getLocale()1获取而不是使用Locale.getDefault()获取。





1 概览

MessageSource is a powerful feature available in Spring applications. This helps application developers handle various complex scenarios with writing much extra code, such as environment-specific configuration, internationalization or configurable values.

One more scenario could be modifying the default validation messages to more user-friendly/custom messages.

In this tutorial, we&rsquo;ll see how to configure and manage custom validation MessageSource in the application using Spring Boot.">


<meta itemprop="datePublished" content="2021-02-20T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-03-03T23:58:24&#43;08:00" />
<meta itemprop="wordCount" content="7616">



<meta itemprop="keywords" content="国际化,springboot," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="在SpringBoot中使用MessageSource"/>
<meta name="twitter:description" content="
几个说明：


properties配置文件中，spring.messages.basename必须要加classpath前缀。如 spring.messages.basename=classpath:i18n/messages；
必须要手动配置MessageSource，springboot不会自动配置之；
如果使用MessageSource.getMessage()方法，第一个参数的引用形式为&quot;code&quot;，而不是&quot;{code}&quot;或者&quot;${code}&quot;。如messageSource.getMessage(&ldquo;test.msg&rdquo;, null, Locale.getDefault())；
在配置LocalValidatorFactoryBean之后，才可以在javax.validation.constraints包下的注解（@Size，@NotNull&hellip;）下的message属性中使用&quot;{code}&quot;的形式声明校验提示信息。如
@NotNull(message = &quot;{leftTime.not.null}&quot;)；
springMVC的locale配置和JVM的locale配置不一样，在application.properties中配置的spring.mvc.locale=zh_CN实际上配置的是WebMvcProperties，在获取消息时，locale信息应该使用webMvcProperties.getLocale()1获取而不是使用Locale.getDefault()获取。





1 概览

MessageSource is a powerful feature available in Spring applications. This helps application developers handle various complex scenarios with writing much extra code, such as environment-specific configuration, internationalization or configurable values.

One more scenario could be modifying the default validation messages to more user-friendly/custom messages.

In this tutorial, we&rsquo;ll see how to configure and manage custom validation MessageSource in the application using Spring Boot."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Endless River</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">主题</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="/friendlink/">
        <li class="mobile-menu-item">友链</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Endless River</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">主题</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friendlink/">友链</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">在SpringBoot中使用MessageSource</h1>

      <div class="post-meta">
          <span>
              <span class="icomoonfree icon-calendar"></span>
              <span class="post-time"> 2021-02-20</span>
          </span>

        <div class="post-category">
              <span class="icomoonfree icon-folder"></span>
            <a href="/categories/java/"> java </a>
            <a href="/categories/spring/"> spring </a>
            </div>
          <span class="icomoonfree icon-sigma"></span>
          <span class="more-meta analyse"> 约 7616 字 </span>
          <span class="icomoonfree icon-clock"></span>
          <span class="more-meta analyse"> 预计阅读 16 分钟 </span>
        <span class="icomoonfree icon-eye"></span>
          <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-概览">1 概览</a></li>
<li><a href="#2-引入maven依赖">2 引入Maven依赖</a></li>
<li><a href="#3-自定义校验信息示例">3 自定义校验信息示例</a></li>
<li><a href="#4-配置messagesource">4 配置MessageSource</a>
<ul>
<li><a href="#4-1-关于messagesource的自动配置">4.1 关于MessageSource的自动配置</a></li>
<li><a href="#4-2-rbms和rrbms">4.2 RBMS和RRBMS</a></li>
</ul></li>
<li><a href="#5-配置localvalidatorfactorybean">5 配置LocalValidatorFactoryBean</a></li>
<li><a href="#6-国际化properties文件">6 国际化properties文件</a>
<ul>
<li><a href="#6-1-messages-properties">6.1 messages.properties</a></li>
<li><a href="#6-2-messages-fr-properties">6.2 messages_fr.properties</a></li>
</ul></li>
<li><a href="#7-结论">7 结论</a></li>
<li><a href="#8-使用并解析message">8 使用并解析message</a>
<ul>
<li><a href="#8-1-localecontextholder和accept-language">8.1 LocaleContextHolder和Accept-Language</a></li>
<li><a href="#8-2-locale-resolver">8.2 Locale Resolver</a></li>
<li><a href="#8-3-通过localechangeinterceptor实现国际化">8.3 通过LocaleChangeInterceptor实现国际化</a></li>
</ul></li>
<li><a href="#9-参考">9 参考</a></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p><span id="hook">几个说明</span>：</p>

<ol>
<li><del>properties配置文件中，<code>spring.messages.basename</code><strong>必须</strong>要加classpath前缀。如 <code>spring.messages.basename=classpath:i18n/messages</code></del>；</li>
<li><del>必须要手动配置<code>MessageSource</code>，springboot不会自动配置之</del>；</li>
<li>如果使用<code>MessageSource.getMessage()</code>方法，第一个参数的引用形式为<code>&quot;code&quot;</code>，而不是<code>&quot;{code}&quot;</code>或者<code>&quot;${code}&quot;</code>。如messageSource.getMessage(&ldquo;test.msg&rdquo;, null, <del>Locale.getDefault()</del>)；</li>
<li>在配置<code>LocalValidatorFactoryBean</code>之后，才可以在<code>javax.validation.constraints</code>包下的注解（<code>@Size</code>，<code>@NotNull</code>&hellip;）下的<strong><em>message</em></strong>属性中使用<code>&quot;{code}&quot;</code>的形式声明校验提示信息。如
<code>@NotNull(message = &quot;{leftTime.not.null}&quot;)</code>；</li>
<li>springMVC的locale配置和JVM的locale配置不一样，在application.properties中配置的<code>spring.mvc.locale=zh_CN</code>实际上配置的是<code>WebMvcProperties</code>，在获取消息时，locale信息应该使用<code>webMvcProperties.getLocale()</code><sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>获取<strong>而不是</strong>使用<code>Locale.getDefault()</code>获取。</li>
</ol>
</blockquote>

<hr />

<h1 id="1-概览">1 概览</h1>

<p>MessageSource is a powerful feature available in Spring applications. This helps application developers handle various complex scenarios with writing much extra code, such as environment-specific configuration, internationalization or configurable values.</p>

<p>One more scenario could be modifying the default validation messages to more user-friendly/custom messages.</p>

<p>In this tutorial, we&rsquo;ll see how to configure and manage custom validation MessageSource in the application using Spring Boot.</p>

<h1 id="2-引入maven依赖">2 引入Maven依赖</h1>

<p>Let&rsquo;s start with adding the necessary Maven dependencies:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-validation<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></td></tr></table>
</div>
</div>
<p>You can find the latest versions of these libraries over on Maven Central.</p>

<h1 id="3-自定义校验信息示例">3 自定义校验信息示例</h1>

<p>Let&rsquo;s consider a scenario where we have to develop an application that supports multiple languages. If the user doesn&rsquo;t provide the correct details as input, we&rsquo;d like to show error messages according to the user&rsquo;s locale.</p>

<p>Let&rsquo;s take an example of a Login form bean:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginForm</span> <span class="o">{</span>

    <span class="c1">// 注意此处的语法，为&#34;{}&#34;形式，在spring项目中，是无法通过ctrl+鼠标左键定位到配置文件的
</span><span class="c1"></span>    <span class="c1">// 若去除大括号，则可以通过ctrl+鼠标左键定位到配置的值
</span><span class="c1"></span>    <span class="nd">@NotEmpty</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">&#34;{email.notempty}&#34;</span><span class="o">)</span>
    <span class="nd">@Email</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="c1">// standard getter and setters
</span><span class="c1"></span><span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Here we&rsquo;ve added validation constraints that verify if an email is not provided at all, or provided, but not following the standard email address style.</p>

<p>To show custom and locale-specific message, we can provide a placeholder as mentioned for the <code>@NotEmpty</code> annotation.</p>

<p>The <code>email.notempty</code>property <strong>will be resolved from a properties files by the MessageSource configuration</strong>.</p>

<h1 id="4-配置messagesource">4 配置MessageSource</h1>

<p>An application context delegates the message resolution to a bean with the exact name messageSource.</p>

<p><strong>ReloadableResourceBundleMessageSource</strong> is the most common MessageSource implementation that resolves messages from resource bundles for different locales:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">MessageSource</span> <span class="nf">messageSource</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">ReloadableResourceBundleMessageSource</span> <span class="n">messageSource</span>
      <span class="o">=</span> <span class="k">new</span> <span class="n">ReloadableResourceBundleMessageSource</span><span class="o">();</span>
    <span class="c1">// 如果使用ReloadableResourceBundleMessageSource，classpath前缀必不可少
</span><span class="c1"></span>    <span class="c1">// classpath前缀告诉ReloadableResourceBundleMessageSource从classpath中获取配置
</span><span class="c1"></span>    <span class="n">messageSource</span><span class="o">.</span><span class="na">setBasename</span><span class="o">(</span><span class="s">&#34;classpath:messages&#34;</span><span class="o">);</span>
    <span class="n">messageSource</span><span class="o">.</span><span class="na">setDefaultEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">messageSource</span><span class="o">;</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Here, it&rsquo;s <strong>important to provide the basename</strong> as locale-specific file names will be resolved based on the name provided.</p>

<h2 id="4-1-关于messagesource的自动配置">4.1 关于MessageSource的自动配置</h2>

<p>实际上，Spring Boot可以自动配置MessageSourece，不过，想要成功配置，有2个条件：</p>

<ol>
<li>Spring Boot自动配置实际上使用的是<strong>ResourceBundleMessageSourece</strong>，不同于<strong>ReloadableResourceBundleMessageSource</strong></li>
<li>你无需再配置别名为&rdquo;messageSource&rdquo;的Bean，也就是说上述的配置必须忽略掉</li>
</ol>

<p>不妨看看MessageSource自动配置相关的类，具体内容在<code>org.springframework.boot.autoconfig.context.MessageSourceAutoConfiguration.java</code>类中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">AbstractApplicationContext</span><span class="o">.</span><span class="na">MESSAGE_SOURCE_BEAN_NAME</span><span class="o">,</span> <span class="n">search</span> <span class="o">=</span> <span class="n">SearchStrategy</span><span class="o">.</span><span class="na">CURRENT</span><span class="o">)</span>
<span class="nd">@AutoConfigureOrder</span><span class="o">(</span><span class="n">Ordered</span><span class="o">.</span><span class="na">HIGHEST_PRECEDENCE</span><span class="o">)</span>
<span class="nd">@Conditional</span><span class="o">(</span><span class="n">ResourceBundleCondition</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageSourceAutoConfiguration</span> <span class="o">{</span>

	<span class="c1">//...
</span><span class="c1"></span><span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>注意该自动配置类上的2个注解：</p>

<ul>
<li><p><code>@ConditionalOnMissingBean(name = AbstractApplicationContext.MESSAGE_SOURCE_BEAN_NAME, search = SearchStrategy.CURRENT)</code></p>

<p>这个注解说明的就是，如果你没有配置messageSource，那么SpringBoot（可能）会自动为你配置</p></li>

<li><p><code>@Conditional(ResourceBundleCondition.class)</code></p>

<p>这是一个条件化注入，条件在<code>ResourceBundleCondition.class</code>中定义。通过名字就知道，Spring Boot自动配置使用的是<strong>ResourceBundleMessageSourece</strong></p></li>
</ul>

<p><code>ResourceBundleCondition.class</code>是<code>MessageSourceAutoConfiguration.class</code>的内部类，以下是其内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">ConditionOutcome</span> <span class="nf">getMatchOutcome</span><span class="o">(</span><span class="n">ConditionContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">AnnotatedTypeMetadata</span> <span class="n">metadata</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">String</span> <span class="n">basename</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">().</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&#34;spring.messages.basename&#34;</span><span class="o">,</span> <span class="s">&#34;messages&#34;</span><span class="o">);</span>
	<span class="n">ConditionOutcome</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">basename</span><span class="o">);</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">outcome</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">outcome</span> <span class="o">=</span> <span class="n">getMatchOutcomeForBasename</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">basename</span><span class="o">);</span>
		<span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">basename</span><span class="o">,</span> <span class="n">outcome</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">return</span> <span class="n">outcome</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="n">ConditionOutcome</span> <span class="nf">getMatchOutcomeForBasename</span><span class="o">(</span><span class="n">ConditionContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">String</span> <span class="n">basename</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">ConditionMessage</span><span class="o">.</span><span class="na">Builder</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ConditionMessage</span><span class="o">.</span><span class="na">forCondition</span><span class="o">(</span><span class="s">&#34;ResourceBundle&#34;</span><span class="o">);</span>
	<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">commaDelimitedListToStringArray</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">trimAllWhitespace</span><span class="o">(</span><span class="n">basename</span><span class="o">)))</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="n">Resource</span> <span class="n">resource</span> <span class="o">:</span> <span class="n">getResources</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span> <span class="n">name</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">resource</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
				<span class="k">return</span> <span class="n">ConditionOutcome</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">found</span><span class="o">(</span><span class="s">&#34;bundle&#34;</span><span class="o">).</span><span class="na">items</span><span class="o">(</span><span class="n">resource</span><span class="o">));</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="k">return</span> <span class="n">ConditionOutcome</span><span class="o">.</span><span class="na">noMatch</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">didNotFind</span><span class="o">(</span><span class="s">&#34;bundle with basename &#34;</span> <span class="o">+</span> <span class="n">basename</span><span class="o">).</span><span class="na">atAll</span><span class="o">());</span>
<span class="o">}</span>

<span class="c1">// basename不需要classpath前缀，它总是从classpath中获取资源
</span><span class="c1"></span><span class="kd">private</span> <span class="n">Resource</span><span class="o">[]</span> <span class="nf">getResources</span><span class="o">(</span><span class="n">ClassLoader</span> <span class="n">classLoader</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">String</span> <span class="n">target</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="sc">&#39;.&#39;</span><span class="o">,</span> <span class="sc">&#39;/&#39;</span><span class="o">);</span>
	<span class="k">try</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="n">PathMatchingResourcePatternResolver</span><span class="o">(</span><span class="n">classLoader</span><span class="o">)</span>
				<span class="o">.</span><span class="na">getResources</span><span class="o">(</span><span class="s">&#34;classpath*:&#34;</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s">&#34;.properties&#34;</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">NO_RESOURCES</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>我们只需要关注<code>getResources</code>方法，可以看到，其自动补全了<code>classpath</code>前缀，因此，<code>ResourceBundleMessageSourece</code>总是从classpath中获取资源的。</p>

<p>如果这两个条件都满足，那么SpringBoot会自动使用<strong>ResourceBundleMessageSourece</strong>配置MessageSource。</p>

<h2 id="4-2-rbms和rrbms">4.2 RBMS和RRBMS</h2>

<ul>
<li>RBMS: <strong>R</strong>esource<strong>B</strong>undle<strong>M</strong>essage<strong>S</strong>ource</li>
<li>RRBMS: <strong>R</strong>eloadable<strong>R</strong>esource<strong>B</strong>undle<strong>M</strong>essage<strong>S</strong>ource</li>
</ul>

<p>在本文的<a href="#hook">文首</a>，标注了几个实践时需要注意的点，现在看来，前2点都是<strong>错误的表述</strong>，因为当时实践时使用的是<code>ReloadableResourceBundleMessageSourece</code>，并且没有搞清楚Spring Boot自动配置MessageSource的条件。</p>

<p>关于这2个“MessageSource”的区别，github上有一个经典的<a href="https://github.com/spring-projects/spring-framework/issues/12050">issue</a>，描述的问题是如果不使用classpath前缀，前者可以读取消息，后者不能读取消息。spring开发人员的回复一针见血：</p>

<blockquote>
<p>I assume your resource bundle files live in the classpath? There is an <strong>important difference</strong> between ResourceBundleMessageSource and ReloadableResourceBundleMessageSource: The former <strong>always loads resource bundles from the classpath</strong> (since that is all that standard java.util.ResourceBundle is capable of),  whereas the latter <strong>loads resource bundle files through the ApplicationContext&rsquo;s ResourceLoader</strong>. If your context is a ClassPathXmlApplicationContext, you won&rsquo;t notice a difference - but if it is a WebApplicationContext, it will try to find the files in the WAR directory structure when not using a prefix. So it would simply not find your files because it is looking in the wrong location.</p>

<p>If my assumption is correct, the following quick fix will allow your messages to be found in their existing location when switching to ReloadableResourceBundleMessageSource:</p>

<p><code>&lt;property name=&quot;basename&quot; value=&quot;classpath:messages&quot;&gt;</code></p>

<p>However, since classpath resources will be cached by the ClassLoader, ReloadableResourceBundleMessageSource&rsquo;s refreshing is likely to not actually work in that case. So I&rsquo;d rather recommend specifying something like the following, operating against an expanded WAR directory structure where WEB-INF resources can be refreshed from the file system:</p>

<p><code>&lt;property name=&quot;basename&quot; value=&quot;WEB-INF/messages&quot;/&gt;</code></p>
</blockquote>

<p>回复指出了ResourceBundleMessageSourece和ReloadableResourceBundleMessageSourece最重要的区别：</p>

<ul>
<li>ResourceBundleMessageSourece<strong>总是</strong>从classpath中加载资源</li>
<li>ReloadableResourceBundleMessageSourece 则从<strong>ApplicationContext&rsquo;s ResourceLoader</strong>中加载资源</li>
</ul>

<p>除此之外，二者还有一些其他的区别：</p>

<ul>
<li>ResourceBundleMessageSourece只能读取properties配置文件，而ReloadableResourceBundleMessageSourece还可以读取xml配置文件</li>
<li>ReloadableResourceBundleMessageSourece可以从任意位置<sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup>读取配置文件</li>
<li>从名字来看，Reloadable是可以动态加载配置文件的，事实上也确实如此，它有一个属性<code>cacheSeconds</code>，用来设置缓存配置文件的时间间隔：

<ul>
<li>默认值是 -1，意味着不动态加载配置文件</li>
<li>如果配置值为0，那么每次获取消息时就会检查配置文件的改动，<strong>这个配置值要慎用</strong></li>
<li>如果配置为其他正整数，则会在固定间隔后检查配置文件改动</li>
</ul></li>
</ul>

<h1 id="5-配置localvalidatorfactorybean">5 配置LocalValidatorFactoryBean</h1>

<blockquote>
<p>为了在<code>javax.validation.constraints</code>包下注解（<code>@NotEmpty</code>、<code>@NotNull</code>等）的校验中使用messageResource，还需要配置<code>LocalValidatorFactoryBean</code></p>
</blockquote>

<p>To use custom name messages in a properties file like we need to define a <strong>LocalValidatorFactoryBean</strong> and register the messageSource:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">LocalValidatorFactoryBean</span> <span class="nf">getValidator</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">LocalValidatorFactoryBean</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalValidatorFactoryBean</span><span class="o">();</span>
    <span class="n">bean</span><span class="o">.</span><span class="na">setValidationMessageSource</span><span class="o">(</span><span class="n">messageSource</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>However, note that if we had already <strong>extended the WebMvcConfigurerAdapter</strong>, to avoid having the custom validator ignored, we&rsquo;d have to set the validator by overriding the getValidator() method from the parent class.</p>

<p>Now we can define a property message like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">“email.notempty=&lt;Custom_Message&gt;”</pre></td></tr></table>
</div>
</div>
<p>instead of</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">“javax.validation.constraints.NotEmpty.message=&lt;Custom_message&gt;”</pre></td></tr></table>
</div>
</div>
<h1 id="6-国际化properties文件">6 国际化properties文件</h1>

<p>The final step is to create a properties file in the src/main/resources directory with the name provided in the basename in step 4:</p>

<h2 id="6-1-messages-properties">6.1 messages.properties</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-properties" data-lang="properties"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-properties" data-lang="properties">email.notempty=Please provide valid email id.</code></pre></td></tr></table>
</div>
</div>
<p>Here we can take advantage of internationalization along with this. Let&rsquo;s say we want to show messages for a French user in their language.</p>

<p>In this case, we have to add one more property file with the name the <code>messages_fr.properties</code> in the same location (No code changes required at all):</p>

<h2 id="6-2-messages-fr-properties">6.2 messages_fr.properties</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-properties" data-lang="properties"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-properties" data-lang="properties">email.notempty=Veuillez fournir un identifiant de messagerie valide.</code></pre></td></tr></table>
</div>
</div>
<h1 id="7-结论">7 结论</h1>

<p>In this article, we covered how the default validation messages can be changed without modifying the code if the configuration is done properly beforehand.</p>

<p>We can also leverage the support of internationalization along with this to make the application more user-friendly.</p>

<hr />

<h1 id="8-使用并解析message">8 使用并解析message</h1>

<p>前文介绍了如何使用MessageResource进行参数校验时的国际化信息展现，最后补充如何在其他部分展现国际化的信息，最显著的一个使用场景就是错误消息的展现。</p>

<p>配置好<code>messages.properties</code>文件之后，我们可以定义一个错误信息的枚举类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-properties" data-lang="properties"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-properties" data-lang="properties"># messages.properties
satisfied.resource.not.found=要处理的资源不存在
unknown.error=未知错误

# other promote messages
no.specific.id.resource=对应id的资源不存在</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="n">ReqState</span> <span class="o">{</span>
    <span class="n">RESPONSE_ADVICE_ERROR</span><span class="o">(</span><span class="n">500_08</span><span class="o">,</span> <span class="s">&#34;response.advice.error&#34;</span><span class="o">),</span>
    <span class="n">SATISFIED_RESOURCE_NOT_FOUND</span><span class="o">(</span><span class="n">500_09</span><span class="o">,</span><span class="s">&#34;satisfied.resource.not.found&#34;</span><span class="o">),</span>

    <span class="n">UNKNOWN_ERROR</span><span class="o">(</span><span class="n">600_00</span><span class="o">,</span> <span class="s">&#34;unknown.error&#34;</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>

    <span class="n">ReqState</span><span class="o">(</span><span class="kt">int</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>和在<code>@NotEmpty</code>注解中使用方式不一样，这里只需要以字符串的形式直接引用即可。当然，这个消息还需要解析（实际上消息是以key-value的形式配置的，以key的形式引用，而要以value的形式呈现，在多语言的环境，可以实现&rdquo;一次引用，多种呈现”的目的），解析的方式也很简单：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Autowired</span>
<span class="n">MessageResource</span> <span class="n">messageSource</span><span class="o">;</span>

<span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="s">&#34;unknown.error&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">LocaleContextHolder</span><span class="o">.</span><span class="na">getLocale</span><span class="o">()))</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>如果此处像文章开头说的那样，使用<code>webMvcProperties.getLocale()</code>的话，在获取HTTP Header设置的Loacle时有些问题。此处使用了<code>LocaleContextHolder.getLocale()</code>，LocaleContextHolder可以灵活地获取每一次Servlet请求的Locale信息。</p>
</blockquote>

<p>我们不妨看看WebMvcProperties类的Locale域：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">* Locale to use. By default, this locale is overridden by the &#34;Accept-Language&#34; header.
</span><span class="cm">*/</span>
<span class="kd">private</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">;</span></code></pre></td></tr></table>
</div>
</div>
<p>注意到，可以通过设置HTTP请求头的方式来设置Locale信息。</p>

<p>实际上，测试发现，通过设置<code>Accept-Language</code>请求头，配合使用<code>LocaleContextHolder.getLocale()</code>获取Locale信息，可以实现国际化效果，而使用<code>webMvcProperties.getLocale()</code>无法总是正确获取请求头设置的Locale信息。</p>

<p>还有一点就是，LocaleContextHolder是通过静态方法获取的Locale信息，相较于webMvcProperties的实例方法，免去了注入<code>WebMvcProperties</code>的麻烦。</p>

<h2 id="8-1-localecontextholder和accept-language">8.1 LocaleContextHolder和Accept-Language</h2>

<p>现在我们知道，可以通过<code>LocaleContextHolder</code>和设置<code>Accept-Language</code>头动态获取请求的Locale信息，那么我们可以在控制器中<a href="https://stackoverflow.com/questions/33049674/elegant-way-to-get-locale-in-spring-controller">这样使用Locale信息</a>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WifeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">MessageSource</span> <span class="n">msgSrc</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/wife/mood&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">readWife</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;whatImDoing&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">iAm</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 获取Locale信息
</span><span class="c1"></span>        <span class="n">Locale</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">LocaleContextHolder</span><span class="o">.</span><span class="na">getLocale</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">iAm</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;playingXbox&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span> <span class="s">&#34;statusTitle&#34;</span><span class="o">,</span> <span class="n">msgSrc</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="s">&#34;mood.angry&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">loc</span><span class="o">)</span> <span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span> <span class="s">&#34;statusDetail&#34;</span><span class="o">,</span> <span class="n">msgSrc</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="s">&#34;mood.angry.xboxdiatribe&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">loc</span><span class="o">)</span> <span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;moodResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>不过，在每个控制器里都需要获取一次Loacle信息，这样的方式似乎有点繁琐。那么是否可以简单一点呢？显然是可以的。</p>

<p><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/mvc.html#mvc-ann-methods">springMvc v3.2.x doc 17.3.3</a>中定义了控制器方法支持的参数：</p>

<blockquote>
<p>&hellip;</p>

<p><code>java.util.Locale</code> for the current request locale, determined by the most specific locale resolver available, in effect, the configured <code>LocaleResolver</code> in a Servlet environment.</p>

<p>&hellip;</p>
</blockquote>

<p>也就是说，Locale可以直接作为参数被HTTP请求传递进来。因此，可以这样改造上述控制器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/wife/mood&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">readWife</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;whatImDoing&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">iAm</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">loc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">iAm</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;playingXbox&#34;</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span> <span class="s">&#34;statusTitle&#34;</span><span class="o">,</span> <span class="n">msgSrc</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="s">&#34;mood.angry&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">loc</span><span class="o">)</span> <span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span> <span class="s">&#34;statusDetail&#34;</span><span class="o">,</span> <span class="n">msgSrc</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="s">&#34;mood.angry.xboxdiatribe&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">loc</span><span class="o">)</span> <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="s">&#34;moodResult&#34;</span><span class="o">;</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>这样简洁多了，SpringMvc简直太聪明了！等等，通过<code>spring.mvc.locale=zh_CN</code>或通过<code>Accept-Language: en;q=0.7,zh-TW;q=0.8,zh-CN;q=0.7</code>这样的形式配置MVC context的Locale信息还是有点麻烦，并且这样的话，前端每次请求都需要手动设置（校验）请求头，麻烦！</p>

<blockquote>
<p>默认情况下，浏览器发起请求的<code>Accept-Language</code>是根据用户语言设置的。</p>
</blockquote>

<p>文章到此，我们已经可以通过配置<strong>WebMvcProperties</strong>和设置<strong>Accept-Language</strong>请求头来<strong>设置</strong>Spring MVC Context的Locale信息；并且通过<code>LocaleContextHolder.getLocale()</code>方法或者直接在控制器中传递<code>Locale</code>参数的形式<strong>获取</strong>Locale信息。</p>

<h2 id="8-2-locale-resolver">8.2 Locale Resolver</h2>

<p>这样看来，国际化的配置还是不够灵活，配置文件的加载以及请求头的设置这两种方法都略显笨重。</p>

<p>去找找文档看看其他的思路吧：</p>

<ul>
<li><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/mvc.html#mvc-localeresolver">(旧版本)springMvc-3.2.x-17.8</a></li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-localeresolver">spring webMvc doc</a></li>
</ul>

<p>当请求进入到控制器时，<code>DispatcherServlet</code>会寻找locale resolver，并使用其设置Locale。使用<code>RequestContext.getLocale()</code>方法总是可以获取到Locale信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/resolver/locale&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ReqResult</span><span class="o">&lt;?&gt;</span> <span class="n">locale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 构建RequestContext
</span><span class="c1"></span>    <span class="n">RequestContext</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RequestContext</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;locale: {}&#34;</span><span class="o">,</span> <span class="n">rc</span><span class="o">.</span><span class="na">getLocale</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">ReqResult</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">rc</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="s">&#34;http.ok&#34;</span><span class="o">),</span> <span class="n">rc</span><span class="o">.</span><span class="na">getLocale</span><span class="o">());</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>这个控制器可能的返回结果为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span>
    <span class="nt">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;en&#34;</span>
<span class="p">}</span>
<span class="p">{</span>
    <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span>
    <span class="nt">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;成功&#34;</span><span class="p">,</span>
    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;zh_CN&#34;</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>RequestContext</code>可以很方便的获取请求中包含的信息，可能的参数绑定（校验）错误等，还能直接获取Spring Message，很强大。</p>

<p>注意到，ServletRequest也有一个<code>getLocale()</code>方法，那么，我们直接从Request中获取Locale不是很方便么？就像这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"> <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/request/locale&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ReqResult</span><span class="o">&lt;?&gt;</span> <span class="n">locale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">){</span>
    <span class="c1">// TODO why this method always return client default locale?
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">ReqResult</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getLocale</span><span class="o">());</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>哈哈。似乎一切都完美。不过，注意看<code>ServletRequest.getLocale()</code>的<a href="https://docs.oracle.com/javaee/6/api/javax/servlet/ServletRequest.html#getLocale()">文档</a>你就会发现问题:
&gt; Returns the <strong>preferred</strong> Locale that the client will accept content in, <em>based on the Accept-Language header</em>. If the client request doesn&rsquo;t provide an Accept-Language header, this method returns the default locale for the server.</p>

<p>也就是说，从request中获取的并不是获取的Spring MVC Context当前使用的Locale信息。这一点在使用了<code>LocaleChangeInterceptor</code>之后，更能够得到<a href="#proof">证明</a>。</p>
</blockquote>

<p>除了<code>RequestContext</code>的方式之外，还可以通过配置拦截器、通过特定的条件（比如请求参数）来更改Locale。</p>

<p>文档提到了几种不同的<code>LocaleResolver</code>：</p>

<ul>
<li><p>AcceptHeaderLocaleResolver</p>

<p>这个locale resolver已经在前文讨论过了，通过设置HTTP Header的<code>Accept-Language</code>请求头可以设置SpringMvc Context的Locale信息。这个resolver在前文就已经试验过了。</p></li>

<li><p>CookieLocaleResolver</p>

<p>这个locale resolver检查cookie中是否声明了Locale信息，如果有，则使用之。</p></li>

<li><p>SessionLocaleResolver</p>

<p>这个locale resolver可以从当前请求的HttpSession中获取Locale和TimeZone信息。由于和Session相关，故在切换Locale时没有cookie灵活，只有session关闭之后Locale配置才能重新设置。</p></li>

<li><p>LocaleChangeInterceptor</p>

<p>这是推荐使用的方式，通过拦截器+请求参数实现国际化。</p></li>
</ul>

<h2 id="8-3-通过localechangeinterceptor实现国际化">8.3 通过LocaleChangeInterceptor实现国际化</h2>

<p>以下两篇文章分别使用xml和java Bean的方式配置了<code>LocaleChangeInterceptor</code>，通过地址栏参数展现国际化信息：</p>

<ul>
<li><a href="https://howtodoinjava.com/spring-mvc/spring-mvc-internationalization-i18n-and-localization-i10n-example/#add_localeresolver_support">[基于xml的配置]Spring MVC Internationalization (i18n) and Localization (i10n) Example</a></li>
<li><a href="https://learningprogramming.net/java/spring-mvc/locale-and-internationalization-in-spring-mvc/">[基于java bean的配置]LOCALE AND INTERNATIONALIZATION IN SPRING MVC</a></li>
</ul>

<p>参考配置地址：</p>

<ul>
<li><a href="https://github.com/wangy325/mybatis-plus-starter/blob/master/web-security-demo/src/main/java/com/wangy/config/MessageSourceConfig.java">https://github.com/wangy325/mybatis-plus-starter/blob/master/web-security-demo/src/main/java/com/wangy/config/MessageSourceConfig.java</a></li>
<li><a href="https://github.com/wangy325/mybatis-plus-starter/blob/master/web-security-demo/src/main/java/com/wangy/config/WebConfig.java">https://github.com/wangy325/mybatis-plus-starter/blob/master/web-security-demo/src/main/java/com/wangy/config/WebConfig.java</a></li>
</ul>

<p>不妨看看<code>LocaleChangeInterceptor</code>是如何工作的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
    <span class="c1">// 从请求路径中获取Locale参数
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">newLocale</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">getParamName</span><span class="o">());</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">newLocale</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">checkHttpMethod</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">()))</span> <span class="o">{</span>
            <span class="c1">// locale resovler
</span><span class="c1"></span>            <span class="n">LocaleResolver</span> <span class="n">localeResolver</span> <span class="o">=</span> <span class="n">RequestContextUtils</span><span class="o">.</span><span class="na">getLocaleResolver</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">localeResolver</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span>
                        <span class="s">&#34;No LocaleResolver found: not in a DispatcherServlet request?&#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">// 设置Locale信息
</span><span class="c1"></span>                <span class="n">localeResolver</span><span class="o">.</span><span class="na">setLocale</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">parseLocaleValue</span><span class="o">(</span><span class="n">newLocale</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">isIgnoreInvalidLocale</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
                        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Ignoring invalid locale value [&#34;</span> <span class="o">+</span> <span class="n">newLocale</span> <span class="o">+</span> <span class="s">&#34;]: &#34;</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">else</span> <span class="o">{</span>
                    <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// Proceed in any case.
</span><span class="c1"></span>    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>可以看到，<code>LocaleChangeInterceptor</code>的工作方式比较简单：</p>

<ol>
<li>从<strong>路径参数</strong>中获取Locale参数配置</li>
<li>获取LocaleResolver</li>
<li>利用LocaleResolver重新设置步骤1中获取的Locale配置</li>
</ol>

<p>这里有一个重点：LocaleResolver。如果不在项目中显示的配置<code>LocaleResolver</code>，那么此拦截器获取到的实例是<code>AcceptHeaderLocaleResolver</code>，这很致命：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// AcceptHeaderLocaleResolver.java
</span><span class="c1"></span><span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">(</span>
				<span class="s">&#34;Cannot change HTTP accept header - use a different locale resolution strategy&#34;</span><span class="o">);</span>
	<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>因为<code>AcceptHeaderLocaleResolver</code>的<code>setLocale()</code>方法直接抛出异常，导致Locale信息无法被设置。</p>

<p>所以，如果使用<code>LocaleChangeInterceptor</code>，那么必须要显式配置一个<code>LocalResolver</code>，可以是<code>SessionLocaleResolver</code>或者<code>CookieLocaleResolver</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">SessionLocaleResolver</span> <span class="nf">localeResolver</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">SessionLocaleResolver</span> <span class="n">sessionLocaleResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SessionLocaleResolver</span><span class="o">();</span>
    <span class="c1">// 配置默认Locale
</span><span class="c1"></span>    <span class="n">sessionLocaleResolver</span><span class="o">.</span><span class="na">setDefaultLocale</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">sessionLocaleResolver</span><span class="o">;</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>这样，保证即使不传递路径国际化参数，也能使用默认的Locale配置。</p>

<p><span id="proof">现在</span>，我们再回头看看从HttpServletRequest中获取当前MVC Context 的Locale信息失败的原因：</p>

<ol>
<li><code>LocaleChangeInterceptor</code>不与<code>AcceptHeaderLocaleResolver</code>兼容</li>
<li>HttpServletRequest从<code>Accept-Language</code>中获取Locale配置，否则返回服务器默认Locale信息</li>
</ol>

<p>这应该比较好理解了，即使设置了<code>Accept-language</code>，这个设置也不能被配置了<code>LocaleChangeInterceptor</code>的mvc容器采纳。</p>

<h1 id="9-参考">9 参考</h1>

<ul>
<li>原文地址： <a href="https://www.baeldung.com/spring-custom-validation-message-source">https://www.baeldung.com/spring-custom-validation-message-source</a></li>
<li><a href="https://zetcode.com/spring/messagesource/">简单使用MessageSource</a></li>
<li><a href="https://stackoverflow.com/questions/15065734/spring-framework-no-message-found-under-code-for-locale/39371075">[stackoverflow] MessageSource配置异常</a></li>
<li><a href="https://stackoverflow.com/questions/39685399/reloadableresourcebundlemessagesource-vs-resourcebundlemessagesource-cache-con">[stackoverflow] 2个MessageSource的区别1</a></li>
<li><a href="https://github.com/spring-projects/spring-framework/issues/12050">[github issue] 2个MessageSource的区别2</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language">如何设置HTTP请求头Accept-Language</a></li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-messagesource">官方文档：使用messageSource进行国际化</a></li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-localeresolver">官方文档：Spring MVC locale resovler</a></li>
<li><a href="https://stackoverflow.com/questions/46412984/controller-httpservletrequest-locale-does-not-change">HttpServletRequest并不能直接获取spring MVC Context当前的Locale信息</a></li>
</ul>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1"><code>LocaleContextHolder</code>是它的完美替代。
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">从文档和一些其他的资料来看，RRBMS是可以从任意位置读取配置文件的，不过笔者并没有实践这一说法。
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>
    </div>

    <div class="post-copyright">
  
  <p class="copyright-item" style= text-align:right;>
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-03-03
        <a href="https://github.com/wangy325/endlessriver/commit/295df1266e6fa3f70793cd28ad39214d102f88db" title="补充mockMvc内容">(295df12)</a>
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E5%9B%BD%E9%99%85%E5%8C%96/">国际化</a>
          <a href="/tags/springboot/">springboot</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/tech/2021-02-20_%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%85%E9%9A%9C/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">一次服务器oom故障</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/tech/java/mockmvc%E7%94%A8%E4%BE%8B2%E5%88%99/">
            <span class="next-text nav-default">在SpringBoot项目中使用MockMvc进行接口测试</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'endlessriver';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=u8za1dzCiImO_8rKldjU1g" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/wangy325" class="iconfont icon-github" title="github"></a>
  <a href="https://wangy325.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme -
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    
    
  </div>

  <span class="copyright-year">
    <span class="author">wangy325</span>
    &copy;
    2019 -
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="copyright"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND</a></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script><script></script><script src="https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js" integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js" integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js" integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js" integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js" integrity="sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css" integrity="sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF" crossorigin="anonymous">
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: {equationNumbers: {autoNumber: "AMS"}},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
